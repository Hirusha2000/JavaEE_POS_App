<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>POS System</title>
    <meta name="viewport" content="width=device-width initial-scale=1">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/fontAwesome/css/all.min.css">
</head>
<body>

<header>
    <nav class="navbar navbar-expand-lg bg-light shadow-sm p-3 mb-5 bg-body rounded">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <img src="../assets/img/logo.png" alt="Logo" width="32" height="32" class="d-inline-block align-text-top">
                Smart<span class="text-danger">POS</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link" href="../index.html">Dashboard</a>
                    <a class="nav-link" href="purchase-order.html">Orders</a>
                    <a class="nav-link active" aria-current="page" href="item.html">Items</a>
                    <a class="nav-link" href="customer.html">Customers</a>
                </div>
            </div>
        </div>
    </nav>
</header>

<main class="container-fluid" id="ItemSection">
    <div class="container d-flex flex-grow-1 flex-column">
        <div class="position-relative d-inline-block mt-3 mt-lg-4 mt-md-4">
            <h2 style="font-family: 'Arial Narrow MT Bold',serif"><i class="fa-solid fa-bag-shopping"></i> Items</h2>
        </div>
    </div>
    <div class="container d-flex flex-grow-1 flex-column shadow rounded-4" style="background-color: #dcdcdc">
        <div class="position-relative d-inline-block mt-3 mt-lg-4 mt-md-4">
            <h6>Home > Items</h6>
            <hr>
        </div>

        <nav class="navbar justify-content-center">
            <div class="col-lg-5 p-2 rounded-3" style="background-color: white">
                <h4 class="text-center p-2 text-light rounded-3" style="background: rgba(38,131,255,0.8)">Search
                    Item</h4>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Input Name/Code Here"
                           aria-label="Search" id="txtItemCode" name="ItemCode">
                    <button class="btn btn-outline-success me-3" type="button">Search</button>
                    <button class="btn btn-outline-warning me-3" type="button">Clear</button>
                </form>
            </div>
        </nav>

        <div class="d-grid gap-4 d-md-flex mt-lg-3 justify-content-md-center">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addItem">Add New
                Item
            </button>
            <button type="button" class="btn btn-danger" id="btnDeleteItem">Delete Item</button>
            <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#updateItem">Update
                Item
            </button>
            <button type="button" class="btn btn-info" id="btnGetAllItems">View All Items</button>
        </div>

        <div class="row mt-1 mt-md-2 mt-lg-4 justify-content-around" style="height: 250px;">
            <div class="col-10">
                <div class="customerTableDiv overflow-auto" style="height: 200px;">
                    <table class="table  table-bordered border-info">
                        <thead class="table-primary text-primary text-center ">
                        <tr>
                            <th scope="col">Item Code</th>
                            <th scope="col">Item Name</th>
                            <th scope="col">Item Price</th>
                            <th scope="col">Item Qyt</th>
                        </tr>
                        </thead>
                        <tbody id="tblItem" class="text-center" data-bs-toggle="modal"
                               data-bs-target="#updateItem"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div class="modal fade" id="addItem" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success-subtle">
                    <h5 class="modal-title">New Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="ubFt" id="ItemSaveForm">
                        <div>
                            <label for="item-ID" class="col-form-label">Item Code:</label>
                            <input name="item-ID" type="text" class="form-control" id="item-ID">
                            <small class="control-error text-danger" id="lblItem-ID"></small>
                        </div>
                        <div>
                            <label for="item-Name" class="col-form-label">Item Name:</label>
                            <input name="item-Name" type="text" class="form-control" id="item-Name">
                            <small class="control-error text-danger" id="lblItem-Name"></small>
                        </div>
                        <div>
                            <label for="item-Price" class="col-form-label">Item Price:</label>
                            <input name="item-Price" type="text" class="form-control" id="item-Price">
                            <small class="control-error text-danger" id="lblItem-Price"></small>
                        </div>
                        <div>
                            <label for="item-Quantity" class="col-form-label">Item Quantity:</label>
                            <input name="item-Quantity" type="text" class="form-control" id="item-Quantity">
                            <small class="control-error text-danger" id="lblItem-Quantity"></small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-outline-success" id="saveItem">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="updateItem" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning-subtle">
                    <h5 class="modal-title">Update Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="ubFt">
                        <div>
                            <label for="itemID" class="col-form-label">Item Code:</label>
                            <input type="text" class="form-control" id="itemID">
                            <small class="control-error text-danger" id="lblItemID"></small>
                        </div>
                        <div>
                            <label for="itemName" class="col-form-label">Item Name:</label>
                            <input type="text" class="form-control" id="itemName">
                            <small class="control-error text-danger" id="lblItemName"></small>
                        </div>
                        <div>
                            <label for="itemPrice" class="col-form-label">Item Price:</label>
                            <input type="text" class="form-control" id="itemPrice">
                            <small class="control-error text-danger" id="lblItemPrice"></small>
                        </div>
                        <div>
                            <label for="itemQuantity" class="col-form-label">Item Quantity:</label>
                            <input type="text" class="form-control" id="itemQuantity">
                            <small class="control-error text-danger" id="lblItemQuantity"></small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-outline-warning" id="updateItemBtn">Update</button>
                </div>
            </div>
        </div>
    </div>

</main>

<script src="../assets/js/jquery-3.7.0.min.js"></script>

<script src="../assets/js/bootstrap.js"></script>

<script>
    getAllItems();

    function getAllItems() {
        $("#tblItem").empty();

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/item',
            success: function (res) {
                console.log(res);

                for (let item of res) {
                    let row = `<tr><td>${item.code}</td><td>${item.description}</td><td>${item.unitPrice}</td><td>${item.qty}</td></tr>`;
                    $("#tblItem").append(row);
                }
                bindItemTrEvents();
            }
        });
    }

    $("#btnGetAllItems").click(function () {
        getAllItems();
    });

    $("#saveItem").click(function () {
        let formData = $("#ItemSaveForm").serialize();
        console.log(formData)

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/item',
            method: "post",
            data: formData,
            success: function (res) {
                alert(res.message);
                getAllItems();
            },
            error: function (error) {
                alert(error.responseJSON.message);
            }
        });
    });

    $("#btnDeleteItem").click(function () {
        let code = $("#txtItemCode").val();

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/item?item-ID=' + code,
            method: "delete",
            success: function (res) {
                alert(res.message);
                getAllItems();
            },
            error: function (error) {
                alert(error.responseJSON.message);
            }

        });
    });

    $("#updateItemBtn").click(function () {
        let code = $("#itemID").val();
        let description = $("#itemName").val();
        let price = $("#itemPrice").val();
        let qty = $("#itemQuantity").val();

        let item = {
            "itemCode": code,
            "itemDescription": description,
            "unitPrice": price,
            "qtyOnHand": qty
        }

        $.ajax({
            url: 'http://localhost:8080/Back_End/pages/item',
            method: "put",
            contentType: "application/json",
            data:JSON.stringify(item),
            success: function (res) {
                alert(res.message);
                getAllItems();
            },
            error: function (error) {
                alert(error.responseJSON.message);
            }
        });
    });

    function bindItemTrEvents() {
        $("#tblItem>tr").click(function (eData) {
            $("#itemID").val($(this).children().eq(0).text());
            $("#itemName").val($(this).children().eq(1).text());
            $("#itemPrice").val($(this).children().eq(2).text());
            $("#itemQuantity").val($(this).children().eq(3).text());
        });
    }

</script>

</body>
</html>